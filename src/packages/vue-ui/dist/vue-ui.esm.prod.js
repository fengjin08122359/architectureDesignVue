import e from"vue";import t from"element-ui";import{Prop as s,Component as l,Vue as a,Watch as r}from"vue-property-decorator";class i{constructor(){this.datas=[]}add(e){this.datas.push(e)}remove(e){this.datas=this.datas.filter(t=>t.name!==e)}clear(){this.datas=[]}get(e=""){return this.datas.filter(t=>""===e||t.name===e)}find(e=""){var t=this.datas.find(t=>t.name===e),s=this.datas.find(e=>""===e.name);return t?t.data:s?s.data:null}}class o{constructor(e){this.key=e.key||"",this.props={label:"",required:"",data:[],disabled:!1,show:!0,placeholder:"",...e.props},this.valid=e.valid||[],this.type=e.type||"",this.value=void 0===e.value?"":e.value,this.children=e.children||[],this.rawData=e,this.rawComponents=e.rawComponents||[],this.canRender=!1}dataFind(e){var t=null;return(this.props.data||[]).forEach(s=>{void 0!==s[e]&&(t=s[e])}),t}setValue(e){var t=this.value;this.value=e,t!=this.value&&this.onChange({val:this.value,oldVal:t})}getKey(){return this.key}getValue(){return this.value}hasChange(){return!(""==this.getValue())}onChange({val:e,oldVal:t}){return{val:e,oldVal:t}}getValid(){var e={success:!0,message:"",type:"success"};return new Promise(t=>{this.key?(this.props.required&&!this.hasChange()&&(e={success:!1,message:this.props.label||"",type:"requiredEmpty"}),t(e)):t(e)})}setDisabled(e=!1){return this.props.disabled=e,this.props.disabled}getKeyValue(){return{key:this.getKey(),value:this.getValue(),children:this.children.map(e=>e.getKeyValue())}}setKeyValue({key:e,value:t,children:s}){""!=this.getKey()&&this.getKey()==e&&(this.setValue(t),s.forEach(e=>{var t=this.children.find(t=>e.key==t.getKey());t&&t.setKeyValue(e)}))}getAllItems(){return this.children.map(e=>e.getAllItems()).concat(this)}getCanRender(){return this.canRender||0==this.rawComponents.length}render(...e){}}class n{constructor(e){}mounted(){}}class p extends o{constructor(e){super(e),this.renderComponent=void 0,this.lifeCycle=new n(e.props?e.props.lifeCycle:{})}render(e,t){return this.getCanRender()?this.renderInstance(e,t):e.createElement()}renderInstance(e,t){return e.createElement(this.renderComponent||"div",{...e.context,props:{target:this,...t}},[e.vueRoot.$slots.default])}}class d extends class{constructor(e=[],t){this.options=t||{needValidHidden:!1},this.needValidHidden=this.options.needValidHidden,this.rawList=e,this.list=[],this.templateList=[],this.componentHasRendered=new i,this.classTarget=new.target,this.reset()}setList(e){this.rawList=e,this.list=[],this.reset()}reset(){this.list=this.rawList.map(e=>{var t=this.convert(e);return t.children&&(t.children=new this.classTarget(t.children,this.options).list),t},[])}addTemplate({key:e,value:t}){var s=this.getValue(),l=this.templateList.find(t=>t.key==e);l?l.value=t:this.templateList.push({key:e,value:t}),this.reset(),this.setValue(s)}removeTemplate(e){var t=this.getValue();this.templateList=this.templateList.filter(t=>t.key!==e),this.reset(),this.setValue(t)}clearTemplate(){var e=this.getValue();this.templateList=[],this.reset(),this.setValue(e)}getTemplate(){return this.templateList}convert(e){var t=this.templateList.find(t=>t.key==e.type);return t&&t.value?new t.value(e):this.convertSinlgeUI(e)}convertSinlgeUI(e){return new o(e)}getValid(){var e=this.getAllItems().filter(e=>this.needValidHidden||0!=e.props.show).map(e=>e.getValid(),[]);return new Promise(t=>{Promise.all(e).then(e=>{var s=e.filter(e=>!e.success);t({success:0==s.length,message:s.length>0?s[0].message:"",type:s.length>0?s[0].type:"success"})})})}setValue(e){e.forEach(e=>{var t=this.list.find(t=>e.key==t.getKey());t&&t.setKeyValue(e)})}getValue(){return this.list.map(e=>e.getKeyValue())}getAllItems(){return this.list.reduce((e,t)=>e=e.concat(t),[])}loadComponents(){return new Promise(e=>{var t=this.getNeedRender();Promise.all(t.map(e=>this.handleComponentKey(e))).then(()=>{e()})})}getNeedRender(){return Array.from(new Set(this.getAllItems().reduce((e,t)=>e=e.concat(t.getCanRender()?[]:t.rawComponents),[])))}load(){return this.loadComponents().then(()=>{var e=this.componentHasRendered.get("key").map(e=>e.data);this.getAllItems().forEach(t=>{!1===t.canRender&&(t.canRender=t.rawComponents.map(t=>e.includes(t)).reduce((e,t)=>e&&t,!0))})})}render(){return this.getAllItems().map(e=>e.render())}handleComponentKey(e){return new Promise(t=>{this.componentHasRendered.add({name:"key",data:e}),t()})}}{constructor(e=[],t){super(e,t)}convertSinlgeUI(e){return new p(e)}handleComponentKey(e){return new Promise(t=>{this.componentHasRendered.add({name:"key",data:e}),t()})}getRenderList(e){return this.getAllItems().map(t=>t.render(e))}}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function u(e,t,s,l){var a,r=arguments.length,i=r<3?t:null===l?l=Object.getOwnPropertyDescriptor(t,s):l;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,s,l);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(t,s,i):a(t,s))||i);return r>3&&i&&Object.defineProperty(t,s,i),i}let h=class extends a{};u([s()],h.prototype,"target",void 0),h=u([l({template:"<div class='inputVue' v-show='target.props.show'> <el-input v-model=\"target.value\" :disabled='target.props.disabled' clearable :type='target.props.inputType'> <template slot='append' v-if='target.props.append'>{{target.props.append}}</template> <template slot=\"prepend\" v-if='target.props.label'>{{target.props.label}}</template> </el-input> </div>"})],h);var c=h;let v=class extends a{};u([s()],v.prototype,"target",void 0),v=u([l({template:'<div class=\'arrayVue\' v-show=\'target.props.show\'> <div>{{target.props.label}}</div> <el-row> <el-col v-for="(item,index) in target.value" :key="index"> <el-input v-model="item.value" > <template slot="append" > <span @click="target.addCol()" class=\'el-icon-circle-plus-outline\'></span> <span v-if="index != 0" @click="target.delCol(index)" class=\'el-icon-remove-outline\'></span> </template> </el-input> </el-col> </el-row> </div>'})],v);var m=v;let g=class extends a{};u([s()],g.prototype,"target",void 0),g=u([l({template:"<div class='objectVue' v-show='target.props.show'> <div>{{target.props.label}}</div> <el-row> <el-col v-for=\"(item,index) in target.props.objectArray\" :key=\"index\"> <el-col :span='10'> <el-input v-model=\"item.key\" > <template slot='prepend'>key</template> </el-input> </el-col> <el-col :span='10'> <el-input v-model=\"item.value\" > <template slot='prepend'>value</template> </el-input> </el-col> <el-col :span='4'> <span @click=\"target.addCol()\" class='el-icon-circle-plus-outline'></span> <span v-if=\"index != 0\" @click=\"target.delCol(index)\" class='el-icon-remove-outline'></span> </el-col> </el-col> </el-row> </div>"})],g);var y=g;let V=class extends a{};u([s()],V.prototype,"target",void 0),V=u([l({template:"<div class='mulSelectVue' v-show='target.props.show'> <div>{{target.props.label}}</div> <div v-if='target.props.configVisible'> <span>选项:</span> <el-row> <el-col v-for=\"(item,index) in target.props.optionsArray\" :key=\"index\"> <el-col :span='10'> <el-input v-model=\"item.key\" > <template slot='prepend'>key</template> </el-input> </el-col> <el-col :span='10'> <el-input v-model=\"item.value\" > <template slot='prepend'>value</template> </el-input> </el-col> <el-col :span='4'> <span @click=\"target.addCol()\" class='el-icon-circle-plus-outline'></span> <span v-if=\"index != 0\" @click=\"target.delCol(index)\" class='el-icon-remove-outline'></span> </el-col> </el-col> </el-row> </div> <span v-if='target.props.configVisible'>结果:</span> <el-select v-model=\"target.value\" multiple filterable clearable> <el-option v-for=\"(item, index) in target.props.optionsArray\" :value=\"item.key\" :label='item.value' :key=\"index\"> </el-option> </el-select></div>"})],V);var f=V;let b=class extends a{};u([s()],b.prototype,"target",void 0),b=u([l({template:"<div class='selectVue' v-show='target.props.show'> <div>{{target.props.label}}</div> <div v-if='target.props.configVisible'> <span>选项:</span> <el-row > <el-col v-for=\"(item,index) in target.props.optionsArray\" :key=\"index\"> <el-col :span='10'> <el-input v-model=\"item.key\" > <template slot='prepend'>key</template> </el-input> </el-col> <el-col :span='10'> <el-input v-model=\"item.value\" > <template slot='prepend'>value</template> </el-input> </el-col> <el-col :span='4'> <span @click=\"target.addCol()\" class='el-icon-circle-plus-outline'></span> <span v-if=\"index != 0\" @click=\"target.delCol(index)\" class='el-icon-remove-outline'></span> </el-col> </el-col> </el-row> </div> <span v-if='target.props.configVisible'>结果:</span> <el-select v-model=\"target.value\" filterable clearable> <el-option v-for=\"(item, index) in target.props.optionsArray\" :value=\"item.key\" :label='item.value' :key=\"index\"> </el-option> </el-select></div>"})],b);var w=b;let C=class extends a{};u([s()],C.prototype,"target",void 0),C=u([l({template:"<div class='numberVue' v-show='target.props.show'> <div>{{target.props.label}}</div> <el-input-number v-model=\"target.value\" :disabled='target.props.disabled' ></el-input-number></div>"})],C);var k=C;let x=class extends a{};u([s()],x.prototype,"target",void 0),x=u([l({template:"<div class='BooleanVueUI' v-show='target.props.show'> <el-checkbox v-model=\"target.value\">是否选中</el-checkbox> </div>"})],x);var A=x;let I=class extends a{watchSimulate(e){this.target.simulate()}};u([s()],I.prototype,"target",void 0),u([r("target.value")],I.prototype,"watchSimulate",null),I=u([l({template:'<div class=\'SimulateVue\' v-show=\'target.props.show\'> <el-input type="textarea" :rows="5" placeholder="模拟框" v-model="target.value"> </el-input> <div>{{target.error}}</div> <div>{{target.simulateValueToString()}}</div> </div>'})],I);var R=I;e.use(t);class j extends p{constructor(e){super(e),this.renderComponent=c}}class K extends p{constructor(e){super(e),Array.isArray(this.value)||(this.value=[]),0==this.value.length&&this.addCol(),this.renderComponent=m}addCol(){this.value.push({value:""})}delCol(e){this.value.splice(e,1)}getValue(){return this.value.map(e=>e.value)}setValue(e){this.value=(e||[]).map(e=>({value:e})),Array.isArray(this.value)||(this.value=[]),0==this.value.length&&this.addCol()}}class S extends p{constructor(e){super(e),this.props.objectArray=this.props.objectArray||[],this.setValue(this.value||{}),0==this.props.objectArray.length&&this.addCol(),this.renderComponent=y}addCol(){this.props.objectArray.push({key:"",value:""})}delCol(e){this.props.objectArray.splice(e,1)}getValue(){return this.props.objectArray.reduce((e,t)=>(e[t.key]=t.value,e),{})}setValue(e){this.value=e||{},this.props.objectArray=[];for(let[e,t]of Object.entries(this.value))this.props.objectArray.push({key:e,value:t});0==this.props.objectArray.length&&this.addCol()}}class L extends p{constructor(e){super(e),this.props.configVisible=this.props.configVisible||[],this.props.optionsArray=this.props.optionsArray||[],this.setValue(this.value||""),0==this.props.optionsArray.length&&this.addCol(),this.renderComponent=f}addCol(){this.props.optionsArray.push({key:"",value:""})}delCol(e){this.props.optionsArray.splice(e,1)}}class U extends p{constructor(e){super(e),this.props.configVisible=this.props.configVisible||[],this.props.optionsArray=this.props.optionsArray||[],this.setValue(this.value||[]),0==this.props.optionsArray.length&&this.addCol(),this.renderComponent=w}addCol(){this.props.optionsArray.push({key:"",value:""})}delCol(e){this.props.optionsArray.splice(e,1)}}class P extends p{constructor(e){super(e),this.renderComponent=k}}class T extends p{constructor(e){super(e),this.value=!!this.value,this.renderComponent=A}}class H extends p{constructor(e){super(e),this.simulateValue="",this.error="",this.simulate(),this.renderComponent=R}getValue(){return this.value}setValue(e){var t=this.value;this.value=e,t!=this.value&&this.onChange({val:this.value,oldVal:t}),this.simulate()}simulate(){this.simulateValue=this.value,this.error="";try{this.simulateValue=JSON.parse(this.value)}catch(e){this.error=e}}simulateValueToString(){return"object"==typeof this.simulateValue?JSON.stringify(this.simulateValue):this.simulateValue}}export{K as ArrayVueUI,T as BooleanVueUI,j as InputVueUI,L as MulSelectVueUI,P as NumberVueUI,S as ObjectVueUI,U as SelectVueUI,H as SimulateVueUI,p as VueUI,d as VueUIList};
